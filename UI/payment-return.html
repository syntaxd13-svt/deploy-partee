<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment Completed â€“ PARTEE</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {font-family:'Lora',serif;background:#f8f9fa;text-align:center;padding-top:100px;}
</style>
</head>
<body>
<div class="container" style="max-width:600px">
  <h1 class="mb-4">ðŸŽ‰ Complete Your Payment</h1>
  <div class="alert alert-info">
    <strong>Step 1:</strong> Complete your payment in the PayMongo tab that opened<br>
    <strong>Step 2:</strong> After payment, return here and click the button below
  </div>
  <button class="btn btn-primary btn-lg mt-3" onclick="verifyPayment()">âœ“ I've Completed Payment - Verify Now</button>
  <p class="text-muted mt-4">Payment not working? <a href="#" onclick="verifyPayment()">Click here</a> to check status</p>
</div>

<script>
function verifyPayment() {
  // Get booking info from URL parameters FIRST
  const params = new URLSearchParams(window.location.search);
  let bookingId = params.get('booking_id');
  let name = params.get('name');
  let amount = params.get('amount');
  
  console.log("Verify payment - URL params:", { bookingId, name, amount });
  
  // If URL params are missing, try sessionStorage
  if (!bookingId || !name || !amount) {
    const bookingInfo = sessionStorage.getItem('booking_info');
    if (bookingInfo) {
      try {
        const data = JSON.parse(bookingInfo);
        bookingId = data.bookingId;
        name = data.name;
        amount = data.total;
        console.log("Using sessionStorage fallback:", { bookingId, name, amount });
      } catch (e) {
        console.error("Failed to parse sessionStorage:", e);
      }
    }
  }
  
  if (bookingId && name && amount) {
    const statusUrl = `payment-status.html?booking_id=${bookingId}&name=${encodeURIComponent(name)}&amount=${amount}`;
    console.log("Redirecting to:", statusUrl);
    window.location.href = statusUrl;
  } else {
    alert('âŒ No pending payment found. Please try booking again.');
    window.location.href = '../index.html';
  }
}

// Auto-check parameters on load
window.addEventListener('load', () => {
  const params = new URLSearchParams(window.location.search);
  console.log("payment-return.html loaded with params:", Object.fromEntries(params));
});
</script>
</body>
</html>