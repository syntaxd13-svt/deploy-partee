<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Select Your VIP Seat – PARTEE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{font-family:'Lora',serif;background:#f8f9fa;margin:0;padding:0}
    .header{background:#212529;color:#fff;text-align:center;padding:60px 0 30px}
    .header h1{font-family:'Poppins',sans-serif;font-size:50px;margin-bottom:10px}
    .seat{
      width:42px;height:42px;background:#6c757d;border-radius:4px;cursor:pointer;
      transition:background .25s;display:inline-block;margin:4px
    }
    .seat:hover{background:#e5b700}
    .seat.selected{background:#FFD700}
    .seat.disabled{background:#adb5bd;cursor:not-allowed}
    .table-card{border:2px solid transparent;border-radius:8px;padding:15px 10px 10px;margin-bottom:25px}
    .table-card.recommended{border-color:#28a745;position:relative}
    .table-card.recommended::before{
      content:"RECOMMENDED";font-size:.75rem;font-weight:600;color:#fff;background:#28a745;
      position:absolute;top:-10px;left:50%;transform:translateX(-50%);padding:2px 8px;border-radius:12px
    }
    .table-card.disabled{background:#e9ecef;border-color:#ced4da}
    .btn-submit{background:#FFD700;color:#212529;border:none;padding:12px 30px;border-radius:25px;font-weight:600}
    .btn-submit:disabled{opacity:.5}
    .btn-back{background:#6c757d;color:#fff;padding:10px 25px;border-radius:25px;text-decoration:none;display:inline-block;font-weight:600}
  </style>
</head>
<body>

<header class="header">
  <div class="container">
    <a href="forms-vip.html" class="btn-back mb-3">← Go Back</a>
    <h1>VIP Seat Selection</h1>
    <p class="mb-0">Choose <strong id="guestCount">—</strong> seat(s) at <strong>one</strong> table for your party</p>
    <p id="statusText" class="mt-2 mb-0 text-warning">Select exactly the required number of seats</p>
  </div>
</header>

<div class="container py-4">
  <div id="tablesWrapper" class="row"></div>
  <div class="text-center mt-4">
    <button id="submitBooking" class="btn-submit" disabled>Submit Booking</button>
  </div>
</div>

<script>
/* ===== CONFIGURATION ===== */
const plan = [
  {id:'center', name:'Center Table', seats:15, prefix:'C'},
  {id:'bar',    name:'Bar Stools',   seats:10, prefix:'S'},
  {id:'sideA',  name:'Side Table A', seats:10, prefix:'A'},
  {id:'sideB',  name:'Side Table B', seats:10, prefix:'B'},
  {id:'sideC',  name:'Table C',      seats:5,  prefix:'C5-'},
  {id:'sideD',  name:'Table D',      seats:5,  prefix:'D5-'},
  {id:'sideE',  name:'Table E',      seats:5,  prefix:'E5-'},
  {id:'sideF',  name:'Table F',      seats:5,  prefix:'F5-'}
];

/* ===== READ GUEST COUNT ===== */
const urlParams = new URLSearchParams(window.location.search);
const guestCount = parseInt(urlParams.get('guests')) || 1;
document.getElementById('guestCount').textContent = guestCount;

/* ===== STATE ===== */
let selectedSeats = []; // [{tableId, seatEl}, ...]
let activeTable   = null; // tableId of current selection

/* ===== RENDER TABLES ===== */
const wrapper = document.getElementById('tablesWrapper');
plan.forEach(t=>{
  const col = document.createElement('div');
  col.className = 'col-lg-6 col-xl-4';
  const suitable = t.seats >= guestCount;
  const smallest = Math.min(...plan.filter(x=>x.seats>=guestCount).map(x=>x.seats));
  const recommended = t.seats === smallest;
  col.innerHTML = `
    <div class="table-card ${suitable?'':'disabled'} ${recommended?'recommended':''}" data-table="${t.id}">
      <h6 class="text-muted mb-2">${t.name} <span class="badge bg-secondary">${t.seats} seats</span></h6>
      <div class="seatPit" data-capacity="${t.seats}" data-table="${t.id}"></div>
    </div>`;
  wrapper.appendChild(col);
  renderSeats(col.querySelector('.seatPit'), t);
});

function renderSeats(pit, table){
  for(let i=1;i<=table.seats;i++){
    const s = document.createElement('div');
    s.className = 'seat';
    s.dataset.seat = table.prefix+i;
    s.title = `${table.name} – ${table.prefix+i}`;
    s.addEventListener('click', handleSeatClick);
    pit.appendChild(s);
  }
  if(table.seats < guestCount) disableTable(pit.parentElement);
}

/* ===== TABLE HELPERS ===== */
function disableTable(card){
  card.querySelectorAll('.seat').forEach(s=>s.classList.add('disabled'));
}
function clearTable(tableId){
  selectedSeats.filter(x=>x.tableId===tableId).forEach(x=>x.seatEl.classList.remove('selected'));
  selectedSeats = selectedSeats.filter(x=>x.tableId!==tableId);
}
function seatsInTable(tableId){
  return selectedSeats.filter(x=>x.tableId===tableId).length;
}

/* ===== SEAT CLICK ===== */
function handleSeatClick(e){
  const seat = e.target;
  if(seat.classList.contains('disabled')) return;
  const tableId = seat.closest('.seatPit').dataset.table;

  /* if user picks a new table, clear previous selection */
  if(activeTable && activeTable!==tableId){
    clearTable(activeTable);
  }
  activeTable = tableId;

  /* toggle seat */
  if(seat.classList.contains('selected')){
    seat.classList.remove('selected');
    selectedSeats = selectedSeats.filter(x=>x.seatEl!==seat);
  }else{
    if(seatsInTable(tableId) >= guestCount) return; // cap at guestCount
    seat.classList.add('selected');
    selectedSeats.push({tableId, seatEl:seat});
  }
  updateStatus();
}

/* ===== STATUS & BUTTON ===== */
function updateStatus(){
  const curr = selectedSeats.length;
  const status = document.getElementById('statusText');
  const btn    = document.getElementById('submitBooking');
  if(curr === guestCount){
    status.textContent = `Perfect! ${curr}/${guestCount} seat(s) selected.`;
    status.className = 'text-success mb-0';
    btn.disabled = false;
  }else{
    status.textContent = `Selected ${curr}/${guestCount} seat(s) – pick exactly ${guestCount}.`;
    status.className = 'text-warning mb-0';
    btn.disabled = true;
  }
}

/* ===== SUBMIT (redirect to payment) ===== */
document.getElementById('submitBooking').addEventListener('click',()=>{
  location.href = `payment.html?guests=${guestCount}`;   // <-- NEW
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>