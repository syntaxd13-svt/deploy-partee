<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment Successful â€“ PARTEE</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {font-family:'Lora',serif;background:#f8f9fa;text-align:center;padding-top:100px;}
  h1 {color:#28a745;}
</style>
</head>
<body>
  <h1>ðŸŽ‰ Payment Successful!</h1>
  <p id="details">Updating your booking...</p>
  <a href="../index.html" class="btn btn-dark mt-4">Return to Home</a>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const client = createClient(
  "https://qoronghxfdamvuxmbjqx.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvcm9uZ2h4ZmRhbXZ1eG1ianF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMTA3NjksImV4cCI6MjA3NTg4Njc2OX0.YJqas5o80oWwfzkpbTQ3ci6CxTuQ_nkOobV6sg0NMXg"
);

const params = new URLSearchParams(window.location.search);
const bookingId = params.get("booking_id");
const name = params.get("name");
const amount = parseFloat(params.get("amount") || 0);

document.getElementById("details").textContent = `Thank you, ${name}! Your payment of â‚±${amount.toLocaleString()} was successful.`;

// âœ… Update Supabase to mark booking as paid
(async ()=>{
  try {
    await client.from("vip_bookings").update({ status: "paid" }).eq("id", bookingId);
    await client.from("payments").insert({
      booking_id: bookingId,
      booking_type: "vip",
      amount: amount,
      method: "GCash",
      status: "completed"
    });
  } catch (err) {
    console.error("Supabase update failed:", err);
  }
})();
</script>
</body>
</html>
